<!doctype html>














<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="zh-CN" data-mode="light">
  <!-- The Head -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta
    name="viewport"
    content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover"
  >

  

  

  
    <!-- Begin Jekyll SEO tag v2.8.0 -->
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="垃圾回收机制" />
<meta name="author" content="张晓岸" />
<meta property="og:locale" content="zh_CN" />
<meta name="description" content="回收对象 —— 当一个变量没有被其他变量或属性引用的时候 全局变量 ：持续到浏览器页面关闭 局部变量 ：函数执行结束后" />
<meta property="og:description" content="回收对象 —— 当一个变量没有被其他变量或属性引用的时候 全局变量 ：持续到浏览器页面关闭 局部变量 ：函数执行结束后" />
<link rel="canonical" href="http://localhost:4000/posts/11.%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/" />
<meta property="og:url" content="http://localhost:4000/posts/11.%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/" />
<meta property="og:site_name" content="安置屋" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-09-05T00:00:00+08:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="垃圾回收机制" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"张晓岸"},"dateModified":"2022-09-05T00:00:00+08:00","datePublished":"2022-09-05T00:00:00+08:00","description":"回收对象 —— 当一个变量没有被其他变量或属性引用的时候 全局变量 ：持续到浏览器页面关闭 局部变量 ：函数执行结束后","headline":"垃圾回收机制","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/11.%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/"},"url":"http://localhost:4000/posts/11.%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6/"}</script>
<!-- End Jekyll SEO tag -->

  

  <title>11. 垃圾回收机制 | 安置屋
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="安置屋">
<meta name="application-name" content="安置屋">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin>
    
      <link rel="preconnect" href="https://fonts.googleapis.com" >
      <link rel="dns-prefetch" href="https://fonts.googleapis.com" >
    
      <link rel="preconnect" href="https://cdn.jsdelivr.net" >
      <link rel="dns-prefetch" href="https://cdn.jsdelivr.net" >
    

    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap">
  

  <!-- GA -->
  

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.2/css/all.min.css">

  <link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css">

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.21.2/dist/tocbot.min.css">
  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css">
  

  
    <!-- Manific Popup -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">
  

  <!-- JavaScript -->

  

  <!-- A placeholder to allow defining custom metadata -->

</head>


  <body>
    <!--
 * @Author: 张晓岸
 * @Date: 2023-10-10 20:47:06
 * @LastEditTime: 2023-12-31 18:51:03
 * @LastEditors: 张晓岸
 * @Description: Do not edit
 * @FilePath: \jekyll-theme-chirpy\_includes\sidebar.html
 * @Company: Do not edit
-->
<!-- The Side Bar -->

<aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end">
  <header class="profile-wrapper">
    <a href="/" id="avatar" class="rounded-circle">
      
        
        <img src="http://127.0.0.1:4000//assets/img/avatar/doraemon.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
      
    </a>

    <h1 class="site-title">
      <a href="/">安置屋</a>
    </h1>
    <p class="site-subtitle fst-italic mb-0">学习笔记外置站</p>
  </header>
  <!-- .profile-wrapper -->

  <nav class="flex-column flex-grow-1 w-100 ps-0">
    <ul class="nav">
      <!-- home -->
      <li class="nav-item">
        <a href="/" class="nav-link">
          <i class="fa-fw fas fa-home"></i>
          <span>首页</span>
        </a>
      </li>
      <!-- the real tabs -->
      
        <li class="nav-item">
          <a href="/categories/" class="nav-link">
            <i class="fa-fw fas fa-stream"></i>
            

            <span>分类</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/tags/" class="nav-link">
            <i class="fa-fw fas fa-tags"></i>
            

            <span>标签</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/archives/" class="nav-link">
            <i class="fa-fw fas fa-archive"></i>
            

            <span>归档</span>
          </a>
        </li>
        <!-- .nav-item -->
      
        <li class="nav-item">
          <a href="/about/" class="nav-link">
            <i class="fa-fw fas fa-info-circle"></i>
            

            <span>关于</span>
          </a>
        </li>
        <!-- .nav-item -->
      
    </ul>
  </nav>

  <div class="sidebar-bottom d-flex flex-wrap  align-items-center w-100">
    

    
      
      <!-- <a href="/" id="avatar" class="rounded-circle">
        
          
          <img src="http://127.0.0.1:4000//assets/img/avatar/doraemon.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
        
      </a> -->
      
        <a
          href="https://github.com/Bug421-GIT"
          aria-label="github"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fab fa-github"></i>
        </a>
      
    
      
      <!-- <a href="/" id="avatar" class="rounded-circle">
        
          
          <img src="http://127.0.0.1:4000//assets/img/avatar/doraemon.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
        
      </a> -->
      
        <a
          href="javascript:location.href = 'mailto:' + ['57689675','qq.com'].join('@')"
          aria-label="email"
          

          

          

          
        >
          <i class="fas fa-envelope"></i>
        </a>
      
    
      
      <!-- <a href="/" id="avatar" class="rounded-circle">
        
          
          <img src="http://127.0.0.1:4000//assets/img/avatar/doraemon.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
        
      </a> -->
      
        <a
          href=""
          aria-label="weixin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-weixin"></i>
        </a>
      
    
      
      <!-- <a href="/" id="avatar" class="rounded-circle">
        
          
          <img src="http://127.0.0.1:4000//assets/img/avatar/doraemon.jpg" width="112" height="112" alt="avatar" onerror="this.style.display='none'">
        
      </a> -->
      
        <a
          href="https://weibo.com/u/1960838465"
          aria-label="weixin"
          

          
            target="_blank"
            
          

          

          
            rel="noopener noreferrer"
          
        >
          <i class="fa-brands fa-weibo"></i>
        </a>
      
    
  </div>
  <!-- .sidebar-bottom -->
</aside>
<!-- #sidebar -->


    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        <!-- The Top Bar -->

<header id="topbar-wrapper" aria-label="Top Bar">
  <div
    id="topbar"
    class="d-flex align-items-center justify-content-between px-lg-3 h-100"
  >
    <nav id="breadcrumb" aria-label="Breadcrumb">
      

      
        
          
            <span>
              <a href="/">
                首页
              </a>
            </span>

          
        
          
        
          
            
              <span>11. 垃圾回收机制</span>
            

          
        
      
    </nav>
    <!-- endof #breadcrumb -->

    <button type="button" id="sidebar-trigger" class="btn btn-link">
      <i class="fas fa-bars fa-fw"></i>
    </button>

    <div id="topbar-title">
      文章
    </div>

    <button type="button" id="search-trigger" class="btn btn-link">
      <i class="fas fa-search fa-fw"></i>
    </button>

    <search class="align-items-center ms-3 ms-lg-0">
      <i class="fas fa-search fa-fw"></i>
      <input
        class="form-control"
        id="search-input"
        type="search"
        aria-label="search"
        autocomplete="off"
        placeholder="搜索..."
      >
    </search>
    <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">取消</button>
  </div>
</header>


        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              <!-- Refactor the HTML structure -->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Change the icon of checkbox -->



<!-- Handle images -->




  
  

  <!-- CDN URL -->
  

  <!-- Add image path -->
  

  
    
      
      
    

    
    

    

    
    

    
    
    

    
      

      
      
      

      
    
      

      
      
      

      
    

    <!-- take out classes -->
    

    
    

    

    
      
    

    <!-- lazy-load images -->
    

    
      <!-- make sure the `<img>` is wrapped by `<a>` -->
      

      
        <!-- create the image wrapper -->
        

        
        
      
    

    <!-- combine -->
    
  

  


<!-- Add header for code snippets -->



<!-- Create heading anchors -->





  
  

  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  

  
  

  
    
    

    
      
        
        
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    
      

      
      

      
      
      

      
    

    
  




<!-- return -->




<article class="px-1">
  <header>
    <h1 data-toc-skip>11. 垃圾回收机制</h1>

    <div class="post-meta text-muted">
      <!-- published date -->
      <span>
        发表于
        <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1662307200"
  data-df="YYYY/MM/DD"
  
    data-bs-toggle="tooltip" data-bs-placement="bottom"
  
>
  2022/09/05
</time>

      </span>

      <!-- lastmod date -->
      

      

      <div class="d-flex justify-content-between">
        <!-- author(s) -->
        <span>
          

          作者

          <em>
            
              
                <a href="">张晓岸</a>
                
              
            
          </em>
        </span>

        <!-- read time -->
        <!-- Calculate the post's reading time, and display the word count in tooltip -->



<!-- words per minute -->










<!-- return element -->
<span
  class="readtime"
  data-bs-toggle="tooltip"
  data-bs-placement="bottom"
  title="2323 字"
>
  <em>12 分钟</em>阅读</span>

      </div>
      <!-- .d-flex -->
    </div>
    <!-- .post-meta -->
  </header>

  <div class="content">
    <ul>
  <li>回收对象 —— 当一个变量没有被其他变量或属性引用的时候
    <ul>
      <li>全局变量 ：持续到浏览器页面关闭</li>
      <li>局部变量 ：函数执行结束后</li>
    </ul>
  </li>
</ul>

<h3 id="数据存储"><span class="me-2">数据存储</span><a href="#数据存储" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

<ul>
  <li>
    <p>基本数据类型 —— 栈</p>
  </li>
  <li>
    <p>引用数据类型 —— 堆，在栈中存储实际对象引用</p>

    <p>当引用数据类型引用目标改变时，旧的栈实际对象失去引用，这变成需要回收的垃圾</p>
  </li>
</ul>

<ol>
  <li>
    <h3 id="两种常用方法"><span class="me-2">两种常用方法</span><a href="#两种常用方法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

    <p>​	垃圾回收并不是实时的，因为开销比较大，所以垃圾回收器会周期性的释放程序中已经不在被引用的垃圾对象。浏览器常使用到两种标准策略：标记清理、引用计数</p>

    <h4 id="1-标记清除法大部分浏览器-mark-sweep"><span class="me-2">1. 标记清除法（大部分浏览器） Mark-Sweep</span><a href="#1-标记清除法大部分浏览器-mark-sweep" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

    <p>两个阶段：</p>

    <ol>
      <li>
        <p>标记：从根节点遍历，给每个可访问的对象打上标记，表示对象可达</p>

        <p style="color:#ccc">（标记打法可以是维护俩个“在不在上下文”的堆栈；也可以是活跃时反转某一位，不活跃时恢复）</p>
      </li>
      <li>
        <p>清除：在没有可用分块空间时（或某个固定频率），对堆内存遍历，回收没有标记的对象（清除无引用对象）</p>
      </li>
    </ol>

    <p>优点：实现简单</p>

    <p>缺点：内存过于碎片化（标记-整理法）；分配速度慢（遍历）</p>

    <p>优化方案：**标记-整理法  Mark-Compact **</p>

    <p>​	清除时对堆内存遍历时，先将被引用的对象移动到一起，然后再清理</p>

    <h4 id="2-引用计数法-reference-counting"><span class="me-2">2. 引用计数法 Reference counting</span><a href="#2-引用计数法-reference-counting" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

    <p>​	追踪每个变量被引用的次数，当引用为0时回收；（回收效率高）：</p>

    <ul>
      <li>赋值给引用值时，引用数 +1；</li>
      <li>保存引用的变量被覆盖了，引用数 -1</li>
    </ul>

    <p>缺点：a 计数器的增减处理频繁，会导致空间的使用效率降低。</p>

    <p>   b <strong>循环引用</strong>无法收回，导致内存泄漏。</p>

    <p><strong>3. 循环引用</strong></p>

    <p>在IE9之前，涉及到COM对象（组件对象模型，Component Object Model），就无法避免 <u>循环引用</u> 的问题：</p>

    <ul>
      <li>BOM 和 DOM 中对象是C++实现的COM对象，使用 <u>引用计数</u> 实现垃圾回收。即使引擎使用 <u>标志清理</u>，设计到COM对象依然可能形成循环引用，即使在页面中删除DOM元素内存也一样。</li>
    </ul>

    <div class="language-js highlighter-rouge"><div class="code-header">
        <span data-label-text="JavaScript"><i class="fas fa-code fa-fw small"></i></span>
      <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">one</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// com对象</span>
<span class="kd">let</span> <span class="nx">obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Object</span><span class="p">()</span> <span class="c1">// 原生obj对象</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span><span class="p">;</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">;</span>
   
<span class="c1">// 避免：确保两者没有联系</span>
<span class="nx">obj</span><span class="p">.</span><span class="nx">element</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">obj</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></div>    </div>

    <p>在IE9之后，BOM 和 DOM 对象都变成了JavaScript对象，避免了循环引用问题，及常见的内存泄露问题。</p>

    <h3 id="分代式垃圾回收机制"><span class="me-2">分代式垃圾回收机制</span><a href="#分代式垃圾回收机制" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

    <ul>
      <li>新生代：对象存活时间短，通常支持 1~8M</li>
      <li>老生代：对象存储 存活时间长、常驻内存的对象</li>
    </ul>

    <p>两个内存区域回收频率不同，V8才有两个垃圾回收器管控：</p>

    <p><a href="http://127.0.0.1:4000/../assets/img/JavaScriptBase.assets/新老生代视图.png" class="popup img-link  shimmer"><img src="http://127.0.0.1:4000/../assets/img/JavaScriptBase.assets/新老生代视图.png" alt="新老生代视图" loading="lazy"></a></p>

    <h4 id="新生代垃圾回收"><span class="me-2">新生代垃圾回收</span><a href="#新生代垃圾回收" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

    <p>​	Cheney算法，将堆内存分为两个区（semispace 半空间）：一个使用状态的空间我们称为<strong>使用区</strong>（From 空间）。一个处于闲置状态的空间称为<strong>空闲区</strong>（To 空间）</p>

    <h5 id="垃圾回收机制翻转-scavenge"><span class="me-2">垃圾回收机制——翻转 （Scavenge）</span><a href="#垃圾回收机制翻转-scavenge" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

    <ul>
      <li>先对使用区中的活动做标记</li>
      <li>标记完成后，将使用区的<u>活动对象</u>复制进空闲区并进行排序</li>
      <li>将原先使用区对象占用的空间释放</li>
      <li>最后进行角色互换，把空闲区变为使用区，使用区变为空闲区</li>
    </ul>

    <p>缺点：由于只能使用堆内存的一半，所以<u>不适用大规模</u>的垃圾回收机制中，是典型的牺牲空间换时间的算法。 —— 新生代内存空间较小、生命周期短（活对象少）</p>

    <h5 id="并行回收"><span class="me-2">并行回收</span><a href="#并行回收" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

    <p>Javascript是一门单线程语言，它是运行在主线程上的，而在进行垃圾回收的时候就会阻塞Javascript脚本的执行，需等待垃圾回收完毕后再恢复脚本执行，这种行为叫全停顿。</p>

    <p>那当GC时间过长就会造成页面卡顿问题。</p>

    <p>那一个人干活慢，n个人一起速度便会是一个人的n倍。程序也一样，我们可以通过</p>

    <p>并行回收机制：引入多个辅助线程来同时处理
新生代对象空间就采用并行策略。在垃圾回收过程中，</p>

    <p>启动多个线程来负责新生代中的垃圾清理，这些线程同时将对象空间中的数据移到空22</p>

    <p>由于这个过程中数据地址会发生改变，所以还需要同步更新引用这些对象的指针。</p>

    <h5 id="新生代何时会到老生代"><span class="me-2">新生代何时会到老生代</span><a href="#新生代何时会到老生代" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

    <ol>
      <li>多次复制后依然存活的对象，可以认为是生命周期教强的对象，移到老生代管理</li>
      <li>复制一个对象在空闲区时，占用空闲区空间的25%，则移到老生代管理 —— 当完成Scavenge回收，空间区变为使用区，会继续参与内存分配，比重过大影响后续内存分配</li>
    </ol>

    <h4 id="老生代垃圾回收"><span class="me-2">老生代垃圾回收</span><a href="#老生代垃圾回收" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4>

    <p>​	老生代数据大多是存活的对象，不需要时常更新，可以使用 <u>标记清收法</u> 回收。在V8中使用 <strong>标记整理法</strong> 解决标记清除后产生的大量内存碎片。</p>

    <h5 id="增量标记-incremental-marking"><span class="me-2">增量标记 （incremental marking）</span><a href="#增量标记-incremental-marking" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

    <p>​	代替 并行策略的全停顿式 的垃圾回收，节省清除较大对象的老生代的时间问题</p>

    <ul>
      <li>一次GC分成多步小GC标记，让JS和小GC标记交替执行，直到标记完成。</li>
      <li>应用逻辑执行一会，垃圾回收与应用逻辑交替执行直到标记阶段完成</li>
    </ul>

    <blockquote>
      <p>存在问题：</p>

      <p>​	小GC标记执行完后是如何暂停执行JS任务？—— 三色标记法</p>

      <p>​	如何进行下一次小GC 标记？—— 惰性清理</p>

      <p>​	如果执行JS任务时刚被标记好的对象引用又被修改了该当如何？ —— 写屏障</p>
    </blockquote>

    <h5 id="三色标记法"><span class="me-2">三色标记法</span><a href="#三色标记法" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

    <ul>
      <li>黑色表示对象自身及对象的引用都被标记（已检查状态）</li>
      <li>白色表示未被标记的对象（初始状态）</li>
      <li>灰色表示自身被标记，自身的引用未被标记（待检查状态）</li>
    </ul>

    <p>执行流程：</p>

    <ol>
      <li>初始所有对象都是白色</li>
      <li>从root对象开始、标记为灰色，并推入标记工作表中；</li>
      <li>当收集器从标记工作表中弹出对象，并访问它所有引用对象时，自身灰色就会变换成黑色</li>
      <li>将自身的下一个引用对象标志为灰色</li>
    </ol>

    <p>一直执行，直到<u>没有可以被标记为灰色</u>的对象，剩下的白色对象都是不可达的，进入清除阶段；</p>

    <p>恢复时，从灰色标记对象开始执行</p>

    <h5 id="写屏障"><span class="me-2">写屏障</span><a href="#写屏障" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

    <p>目的：</p>

    <ul>
      <li>解决黑色对象在程序执行中被新添加引用</li>
      <li>已经标记黑色的被引用对象不再被引用了</li>
    </ul>

    <p>写屏障就有了以下两个变化：</p>

    <p>​	1. 不对已标记的黑色对象做处理，因为在之后的GC中也会被清理。</p>

    <ol>
      <li>Write-barrier 机制强制不变黑的对象指向白色对象。
        <ul>
          <li>这个也被称作<u>强三色不变性</u>。所以</li>
          <li>一旦有黑色对象引用白色对象，该机制会强制将引用的白色对象改为灰色</li>
          <li>从而保证下一次增量 GC 标记阶段可以正确标记</li>
        </ul>
      </li>
    </ol>

    <h5 id="惰性清理-lazy-sweeping"><span class="me-2">惰性清理 （lazy sweeping）</span><a href="#惰性清理-lazy-sweeping" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h5>

    <p>​	增量标记完后，如果当前内存足以支持代码的快速运行，也没必要立即清理，可让程序先运行，也无需一次性清理完所有垃圾对象，可以按需清理直到所有垃圾对象清理完后再继续增量标记。</p>

    <h3 id="v8-script-隐藏类"><span class="me-2">V8 script 隐藏类</span><a href="#v8-script-隐藏类" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

    <p><a href="https://zhuanlan.zhihu.com/p/591353951?utm_id=0">JS 性能优化 —– V8 隐藏类</a></p>

    <p>​	“一次性声明”：避免生成不同的隐藏类，“先创建再补充”式动态属性赋值，并在构造函数中<u>一次性声明所有属性</u></p>

    <p>​	“置空不删除”：动态删除属性和新增属性一样，使得同一个构造函数出来的实例不再共享隐藏类。最佳方案是 <code class="language-plaintext highlighter-rouge">= null</code></p>

    <h3 id="优化程序回收提高性能"><span class="me-2">优化程序回收，提高性能</span><a href="#优化程序回收提高性能" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3>

    <ol>
      <li>手动回收（不建议）：<code class="language-plaintext highlighter-rouge">window.ColloectGarbage()</code>（IE）、<code class="language-plaintext highlighter-rouge">window.opera.collect()</code>（opera7以上）立即启动垃圾回收；</li>
      <li>解除引用：将不需要的数据设置为null，释放其引用，在下次回收时释放内存。
      1. 使用 <u>块级作用域</u> ，尽早让垃圾回收程序介入。</li>
    </ol>
  </li>
</ol>

  </div>

  <div class="post-tail-wrapper text-muted">
    <!-- categories -->
    
      <div class="post-meta mb-3">
        <i class="far fa-folder-open fa-fw me-1"></i>
        
          <a href="/categories/javascript/">JavaScript</a>,
          <a href="/categories/object/">Object</a>
      </div>
    

    <!-- tags -->
    
      <div class="post-tags">
        <i class="fa fa-tags fa-fw me-1"></i>
        
          <a
            href="/tags/javascriptbase/"
            class="post-tag no-text-decoration"
          >javascriptBase</a>
        
      </div>
    

    <div
      class="
        post-tail-bottom
        d-flex justify-content-between align-items-center mt-5 pb-2
      "
    >
      <div class="license-wrapper">
        
          

          本文由作者按照 
        <a href="https://creativecommons.org/licenses/by/4.0/">
          CC BY 4.0
        </a>
         进行授权
        
      </div>

      <!-- Post sharing snippet -->

<div class="share-wrapper d-flex align-items-center">
  <span class="share-label text-muted me-1">分享</span>
  <span class="share-icons">
    
    
    

    
      
      <a
        href="https://twitter.com/intent/tweet?text=11.%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%20-%20%E5%AE%89%E7%BD%AE%E5%B1%8B&url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2F11.%25E5%259E%2583%25E5%259C%25BE%25E5%259B%259E%25E6%2594%25B6%25E6%259C%25BA%25E5%2588%25B6%2F"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Twitter"
        target="_blank"
        rel="noopener"
        aria-label="Twitter"
      >
        <i class="fa-fw fa-brands fa-square-x-twitter"></i>
      </a>
    
      
      <a
        href="https://www.facebook.com/sharer/sharer.php?title=11.%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%20-%20%E5%AE%89%E7%BD%AE%E5%B1%8B&u=http%3A%2F%2Flocalhost%3A4000%2Fposts%2F11.%25E5%259E%2583%25E5%259C%25BE%25E5%259B%259E%25E6%2594%25B6%25E6%259C%25BA%25E5%2588%25B6%2F"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Facebook"
        target="_blank"
        rel="noopener"
        aria-label="Facebook"
      >
        <i class="fa-fw fab fa-facebook-square"></i>
      </a>
    
      
      <a
        href="https://t.me/share/url?url=http%3A%2F%2Flocalhost%3A4000%2Fposts%2F11.%25E5%259E%2583%25E5%259C%25BE%25E5%259B%259E%25E6%2594%25B6%25E6%259C%25BA%25E5%2588%25B6%2F&text=11.%20%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%20-%20%E5%AE%89%E7%BD%AE%E5%B1%8B"
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="Telegram"
        target="_blank"
        rel="noopener"
        aria-label="Telegram"
      >
        <i class="fa-fw fab fa-telegram"></i>
      </a>
    

    <button
      id="copy-link"
      aria-label="Copy link"
      class="btn small"
      data-bs-toggle="tooltip"
      data-bs-placement="top"
      title="分享链接"
      data-title-succeed="链接已复制！"
    >
      <i class="fa-fw fas fa-link pe-none"></i>
    </button>
  </span>
</div>

    </div>
    <!-- .post-tail-bottom -->
  </div>
  <!-- div.post-tail-wrapper -->
</article>


            
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 mb-5 text-muted">
            <div class="access">
              <!-- Get the last 5 posts from lastmod list. -->















              <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/javascriptbase/">javascriptBase</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/computernetwork/">computerNetwork</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/javascriptthread/">javascriptThread</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/thread/">Thread</a>
      
    </div>
  </section>


            </div>

            
              
              
            
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            
              
              <!-- Recommend the other 3 posts according to the tags and categories of the current post. -->

<!-- The total size of related posts -->


<!-- An random integer that bigger than 0 -->


<!-- Equals to TAG_SCORE / {max_categories_hierarchy} -->














  

  
    
  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  











  <aside id="related-posts" aria-labelledby="related-label">
    <h3 class="mb-4" id="related-label">相关文章</h3>
    <nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4">
      
        <article class="col">
          <a href="/posts/5.%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1661184000"
  data-df="YYYY/MM/DD"
  
>
  2022/08/23
</time>

              <h4 class="pt-0 my-2">5. 构造函数</h4>
              <div class="text-muted">
                <p>
                  





                  构造函数

​	定义： 与普通函数差别在于——使用了new调用

function Person(name, age, job){
    this.name = name; 
    // ...
    this.sayhello = funciton(){ 
    	console.log(&#39;my name is&#39; + this.name)
    }
}
// 使用new定义Per...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/6.%E7%B1%BB/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1661356800"
  data-df="YYYY/MM/DD"
  
>
  2022/08/25
</time>

              <h4 class="pt-0 my-2">6. 类</h4>
              <div class="text-muted">
                <p>
                  





                  
  声明：class name(){ }；实例：new name( )


// 类声明
class Person {}
// 类表达式
const Animal = class AnimalClass {};

// 接收类的变量名称可以改变，之后可以通过 Aniaml.name 属性获取类名称字符串；但不能单独使用类名称字符串访问类
Animal.name // AnimalClass...
                </p>
              </div>
            </div>
          </a>
        </article>
      
        <article class="col">
          <a href="/posts/7.%E5%87%BD%E6%95%B0/" class="post-preview card h-100">
            <div class="card-body">
              <!--
  Date format snippet
  See: ${JS_ROOT}/utils/locale-dateime.js
-->




<time
  
  data-ts="1661443200"
  data-df="YYYY/MM/DD"
  
>
  2022/08/26
</time>

              <h4 class="pt-0 my-2">7. 函数</h4>
              <div class="text-muted">
                <p>
                  





                  

​	函数存在提升的问题，优先级比变量优先级高

定义


  
    函数表达式  — let fun = function() {}
  
  
    构造函数 ——  new Function() {}

    
      参数必须是字符串格式
      所有函数都是Function的实例、也是对象（引用类型）
      new Function(“参数1”,”参数2”,...
                </p>
              </div>
            </div>
          </a>
        </article>
      
    </nav>
  </aside>
  <!-- #related-posts -->


            
              
              <!-- Navigation buttons at the bottom of the post. -->

<nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation">
  
  

  
    <a
      href="/posts/10.%E4%BA%8B%E4%BB%B6/"
      class="btn btn-outline-primary"
      aria-label="上一篇"
    >
      <p>10. 事件</p>
    </a>
  

  
    <a
      href="/posts/%E5%B7%A5%E4%BD%9C%E8%80%85%E7%BA%BF%E7%A8%8B/"
      class="btn btn-outline-primary"
      aria-label="下一篇"
    >
      <p>工作者线程</p>
    </a>
  
</nav>

            
              
              <!--  The comments switcher -->


            

            <!-- The Footer -->

<footer
  aria-label="Site Info"
  class="
    d-flex flex-column justify-content-center text-muted
    flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3
  "
>
  <p>
    ©
    <time>2024</time>
    <a href="">Ana-Anan</a>.
    
      <span
        data-bs-toggle="tooltip"
        data-bs-placement="top"
        title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。"
      >保留部分权利。</span>
    
  </p>

  <p>本站采用 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 主题 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
  </p>
</footer>

          </div>
        </div>

        <!-- The Search results -->

<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-11 content">
    <div id="search-hints">
      <!-- The trending tags list -->















  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
        
        

  
    
    
    
    
  
    
    
    
    
  
    
    
    
    
      
    
  
    
    
    
    
      
        
        



  <section>
    <h2 class="panel-heading">热门标签</h2>
    <div class="d-flex flex-wrap mt-3 mb-1 me-3">
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/javascriptbase/">javascriptBase</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/computernetwork/">computerNetwork</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/javascriptthread/">javascriptThread</a>
      
        
        <a class="post-tag btn btn-outline-primary" href="/tags/thread/">Thread</a>
      
    </div>
  </section>


    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>

      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask"></div>

    
      <aside
  id="notification"
  class="toast"
  role="alert"
  aria-live="assertive"
  aria-atomic="true"
  data-bs-animation="true"
  data-bs-autohide="false"
>
  <div class="toast-header">
    <button
      type="button"
      class="btn-close ms-auto"
      data-bs-dismiss="toast"
      aria-label="Close"
    ></button>
  </div>
  <div class="toast-body text-center pt-0">
    <p class="px-2 mb-3">发现新版本的内容。</p>
    <button type="button" class="btn btn-primary" aria-label="Update">
      更新
    </button>
  </div>
</aside>

    

    <!-- JavaScripts -->

    <!-- JS selector for site. -->

<!-- commons -->



<!-- layout specified -->


  

  
    <!-- image lazy-loading & popup & clipboard -->
    
  















  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  

  
    

    

  



  <script src="https://cdn.jsdelivr.net/combine/npm/jquery@3.7.1/dist/jquery.min.js,npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js,npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/magnific-popup@1.1.0/dist/jquery.magnific-popup.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.10/dayjs.min.js,npm/dayjs@1.11.10/locale/zh.min.js,npm/dayjs@1.11.10/plugin/relativeTime.min.js,npm/dayjs@1.11.10/plugin/localizedFormat.min.js,npm/tocbot@4.21.2/dist/tocbot.min.js"></script>






<script defer src="/assets/js/dist/post.min.js"></script>






    

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script>
  /* Note: dependent library will be loaded in `js-selector.html` */
  SimpleJekyllSearch({
    searchInput: document.getElementById('search-input'),
    resultsContainer: document.getElementById('search-results'),
    json: '/assets/js/data/search.json',
    searchResultTemplate: '  <article class="px-1 px-sm-2 px-lg-4 px-xl-0">    <header>      <h2><a href="{url}">{title}</a></h2>      <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">        {categories}        {tags}      </div>    </header>    <p>{snippet}</p>  </article>',
    noResultsText: '<p class="mt-5"></p>',
    templateMiddleware: function(prop, value, template) {
      if (prop === 'categories') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
        }
      }

      if (prop === 'tags') {
        if (value === '') {
          return `${value}`;
        } else {
          return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
        }
      }
    }
  });
</script>

  </body>
</html>

