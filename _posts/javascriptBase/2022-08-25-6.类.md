---
title: 6. ç±»
author: "Ana-Ana"
date: 2022-08-25
tags: [javascriptBase]
categories: ["JavaScript","Object","åŸå‹é“¾"]
render_with_liquid: true
layout: post
pin: true
---

- å£°æ˜ï¼š`class name(){ }`ï¼›å®ä¾‹ï¼š`new name( )`

```javascript
// ç±»å£°æ˜
class Person {}
// ç±»è¡¨è¾¾å¼
const Animal = class AnimalClass {};

// æ¥æ”¶ç±»çš„å˜é‡åç§°å¯ä»¥æ”¹å˜ï¼Œä¹‹åå¯ä»¥é€šè¿‡ Aniaml.name å±æ€§è·å–ç±»åç§°å­—ç¬¦ä¸²ï¼›ä½†ä¸èƒ½å•ç‹¬ä½¿ç”¨ç±»åç§°å­—ç¬¦ä¸²è®¿é—®ç±»
Animal.name // AnimalClass
AnimalClass // undefined
```

â€‹	ç±»è¡¨è¾¾å¼`Animal`ï¼Œåœ¨å®ƒä»¬æ±‚å€¼ä¹‹å‰ä¸èƒ½è¢«å¼•ç”¨ï¼Œä¸”ä¸èƒ½è¢«æå‡ã€‚

- ä½œç”¨åŸŸï¼š **å—çº§ä½œç”¨åŸŸ** é™åˆ¶

### ç±»çš„æ„æˆ

#### ç±»æ–¹æ³•

â€‹	ç±»æ–¹æ³•ç­‰åŒäºå¯¹è±¡å±æ€§ï¼Œå…¶é”®å¯ä»¥æ˜¯ å­—ç¬¦ä¸²ã€ç¬¦å·ã€æˆ–æ˜¯è®¡ç®—åçš„å€¼

```JavaScript
class Person(){ // ç±»åé¦–å­—æ¯å¤§å†™ï¼›ç±»ä¸­çš„æ–¹æ³•ï¼Œ ä¸éœ€è¦functionï¼›æ–¹æ³•ä¹‹é—´ä¸éœ€è¦, éš”å¼€
    // æ„é€ æ–¹æ³•
	construct(uname){
        // å®ä¾‹æˆå‘˜
		this.name = uname; // è‡ªåŠ¨æ·»åŠ äº†å±æ€§
	}
    // å®ä¾‹æ–¹æ³•
	sing(song) {
		console.log(this.name + song);
	}
    // é™æ€æ–¹æ³•ï¼šæ¯ä¸ªç±»ä¸Šåªæœ‰ä¸€ä¸ªï¼Œthiså¼•ç”¨è‡ªèº«ï¼›é€‚åˆç”¨ä½œå®ä¾‹å·¥ç¨‹
    static shareWithSub() {}
    // è·å–å‡½æ•°
    get myName {}
    // è®¾ç½®å‡½æ•°
    set myName(newName) {}
}
```

#### æˆå‘˜æ•°æ®

â€‹	æŠŠæ–¹æ³•å®šä¹‰åœ¨ç±»æ„é€ å‡½æ•°ã€ç±»å—ä¸­ï¼Œä½†ä¸èƒ½åœ¨<u>ç±»å—ä¸­</u>ç»™åŸå‹æ·»åŠ åŸå§‹å€¼ã€å¯¹è±¡ä½œä¸ºæˆå‘˜æ•°æ®ã€‚ç»™åŸå‹å®šä¹‰æˆå‘˜æ•°æ®ï¼š

```javascript
Person.prototype.greeting = 'my name is'
Person.name = 'Jack'
console.log(`${Person.prototype.greeting} ${this.name}`)
```

#### è¿­ä»£å™¨ & ç”Ÿæˆå™¨

```javascript
class Person {
    *createNameIterator(){ // åŸå‹ä¸Šå®šä¹‰è¿­ä»£å™¨
		yield 'Jack';
		yield 'Mack';
		yield 'Anry';        
    }
    static *createTimeIterator(){ // ç±»ä¸Šå®šä¹‰è¿­ä»£å™¨
		yield '220101';
		yield '220102';
		yield '220103';        
    }
}
const timeIterator = Person.createTimeIterator
timeIterator.next().value //220101
timeIterator.next().value //220102

let p = new Person();
const nameIterator = p.createNameIterator()
nameIterator.next().value //Jack
nameIterator.next().value //Mack
```

â€‹	æ·»åŠ ä¸€ä¸ªé»˜è®¤è¿­ä»£å™¨ï¼ŒæŠŠç±»å®ä¾‹å˜æˆå¯è¿­ä»£å¯¹è±¡

```javascript
class Person() {
    constructor(){
        this.name = ['Jack','Mack','Anry']
    }
	*[Symbol.iterator]() { // è¿”å›è¿­ä»£å™¨ï¼Œä¸ç›´æ¥æ‰§è¡Œå†…éƒ¨æŒ‡ä»¤
        yield *this.name.entries();
    }
    [Symbol.iterator]() { // è¿”å›å…ƒç´ åœ°å€ï¼Œé”®å€¼å¯¹
        yield *this.name.entries();
    }
}
```



```javascript
class Star {
    constructor( name, age ){
        this.btn = document.querySelector('button');
        this.btn.onclick = this.sing; 	// å½“ç‚¹å‡»æ—¶ï¼Œè°ƒç”¨singå‡½æ•°ï¼Œ
        this.btn.onclick = this.sing(); // ç«‹å³æ‰§è¡Œsingå‡½æ•°ï¼Œundefined
       	/**
        ä¸ªäººç†è§£ï¼šthis.sing ä¼ å…¥äº†å‡½æ•°æ‰€åœ¨çš„åœ°å€ï¼Œç‚¹å‡»æ—¶æŸ¥æ‰¾åˆ°å‡½æ•°å†è°ƒç”¨ï¼›thisæŒ‡å‘è°ƒç”¨è€…
                this.sing() æ˜¯å‡½æ•°è°ƒç”¨è¯­å¥ï¼Œè¿”å›çš„ç»“æœèµ‹å€¼ç»™æŒ‰é’®ï¼›thisæŒ‡å‘æ„é€ è€…
        */
    }
}
```

### å®ä¾‹åŒ–

â€‹	**ç±»å¿…é¡»ä½¿ç”¨newå®ä¾‹åŒ–å¯¹è±¡ã€‚**è§£é‡Šå™¨åœ¨ä½¿ç”¨`new`æ“ä½œç¬¦åˆ›å»ºç±»æ—¶ï¼Œéœ€è¦è°ƒç”¨`constructor`å…³é”®å­—å®šä¹‰çš„å‡½æ•°ã€‚ä¸å®šä¹‰æ„é€ å‡½æ•°ï¼Œç›¸å½“äºä½¿ç”¨ç©ºå‡½æ•°ã€‚[ä½¿ç”¨`new`æ“ä½œç¬¦æ—¶ï¼Œæ‰§è¡Œå››ä¸ªæ­¥éª¤](#newOperate)ã€‚

â€‹	ç±»å®ä¾‹åŒ–æ—¶ä¼ å…¥çš„å‚æ•°ï¼Œä¼šä½œä¸ºæ„é€ å‡½æ•°çš„å‚æ•°ã€‚**é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿”å›æ„é€ å‡½æ•°åˆ›å»ºçš„å¯¹è±¡**ï¼›å¦‚æœä¿®æ”¹é»˜è®¤è¿”å›å€¼ï¼Œè€Œæ˜¯å…¶ä»–å¯¹è±¡ï¼Œè¿™ä¸ªç»“æœå°†ä¸ä¼šè¢«`instanceOf`æ£€æµ‹å‡ºè·Ÿç±»æœ‰ä»»ä½•å…³ç³»ã€‚

```javascript
class Person{
    constructor(){
        return {}
    }
}
let p1 = new Person(); // {}
```

â€‹	ç±»çš„æ„é€ å‡½æ•°ï¼Œé™¤äº†å¿…é¡»ä½¿ç”¨`new`æ“ä½œç¬¦è°ƒç”¨ï¼Œåœ¨ç±»å®ä¾‹åŒ–å®Œæˆåï¼Œå°±æˆä¸ºäº†ä¸€ä¸ªæ™®é€šçš„å®ä¾‹æ–¹æ³•ã€‚

â€‹	æ™®é€šæ„é€ å‡½æ•°ä¸ä½¿ç”¨`new`è°ƒç”¨ï¼Œä»¥å…¨å±€çš„`this`ï¼ˆé€šå¸¸æ˜¯`window`ï¼‰ä½œä¸ºå†…éƒ¨å¯¹è±¡

```javascript
let p1 = new Person(); // {} 
p1 instanceof Person  // true

let p2 = new Person.constructor(); // ä½¿ç”¨æ„é€ å‡½æ•°å¼•ç”¨æ„é€ ä¸€ä¸ªæ–°å®ä¾‹
p2 instanceof Performance //false

p1 == p2 // false
```

â€‹	**ç±»ä¸­å®šä¹‰çš„`constructor()`ä¸ä¼šè¢«å½“ä½œæ„é€ å‡½æ•°**

![ç±»ä¸ç±»çš„æ„é€ å‡½æ•°.drawio](../assets/img/JavaScriptBase.assets/ç±»ä¸ç±»çš„æ„é€ å‡½æ•°.drawio.png)



â€‹	**ç±»çš„æœ¬è´¨æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°ã€‚ç±»**æ ‡è¯†ç¬¦æœ‰`prototype`å±æ€§ï¼Œè¿™ä¸ªåŸå‹ä¸­çš„`constructor`å±æ€§æŒ‡å‘ç±»è‡ªèº«ã€‚ **ç±»ä¸­å®šä¹‰çš„`constructor()`ä¸ä¼šè¢«å½“ä½œæ„é€ å‡½æ•°**

â€‹	ï¼ˆå®ä¾‹åªä¿ç•™æŒ‡å‘åŸå‹çš„æŒ‡é’ˆ`[[prototype]]`ï¼Œæ²¡æœ‰æŒ‡å‘æ„é€ å‡½æ•°çš„æŒ‡é’ˆï¼‰

```javascript
typeof Person // function
// Person è¢«è®¤ä¸ºæ˜¯æ„é€ å‡½æ•°
Person === Person.prototype.constructor // true
```

### ç”¨æ³•

#### ä½œä¸ºå‚æ•°

```javascript
let classList = [
    class {
        constructor(id){
            this.id = id;
            console.log(`instance ${this.id}`)
        }
    }
]
function createInstance(classDefinition, id){
    return new classDefinition(id)
}
let foo = createInstance(classList[0],1); // æ‰¹é‡ç”Ÿæˆç±» foo = classListÂ {id: 1}
```

#### ç«‹å³å®ä¾‹åŒ–

```javascript
new class Foo {
 	constructor(id){
        this.id = id;
        console.log(`instance ${this.id}`)
    }    
}(1)
```

### ç»§æ‰¿

```javascript
class Father {
    constructor (x, y) { // 1.çˆ¶ç±»ç”Ÿæˆå®ä¾‹æ—¶ï¼Œçˆ¶ç±»çš„xã€yè¢«èµ‹å€¼
        this.x = x;
        this.y = y;
    }
    sum() {
    	console.log(this.x + this.y); // 2.è¿™é‡ŒthisæŒ‡å‘çˆ¶ç±»çš„xã€y
    }
}
class Son extends Father {
    constructor (x, y) {
        // 4. æ­¤å¤„åº”è¯¥è°ƒç”¨çˆ¶ç±»å¯¹æ„é€ æ–¹æ³•ï¼šsuper(x, y);
        this.x = x;
        this.y = y;
    }
}
let son = new Son(1, 2); // 3.ç”Ÿæˆæ˜¯å­ç±»ï¼Œçˆ¶ç±»æ„é€ å‡½æ•°æœªè°ƒç”¨ï¼Œçˆ¶ç±»çš„xã€yè¿˜æ˜¯undefinedï¼Œä¸èƒ½è®¡ç®—

son.sum(); // æŠ¥é”™ï¼
```

- `extends` å¯ä»¥åœ¨ç±»è¡¨è¾¾å¼ä¸­ä½¿ç”¨ï¼š `const son  = new Son extends Father`
- `this` è°è°ƒç”¨æŒ‡å‘è°
- superå…³é”®å­—ï¼šè°ƒç”¨çˆ¶ç±»çš„å‡½æ•°ï¼ˆæ„é€ å‡½æ•°ã€é™æ€å‡½æ•°ï¼‰
  - åªèƒ½åœ¨æ´¾ç”Ÿç±»çš„æ„é€ å‡½æ•°ã€é™æ€å‡½æ•°ä¸­è°ƒç”¨
    - åœ¨æ„é€ å‡½æ•°ä¸­ä½¿ç”¨`super()`ï¼Œè¡¨ç¤ºç›´æ¥è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°`super.constructor()`ï¼Œéœ€è¦æ‰‹åŠ¨ä¼ å…¥
    - é™æ€å‡½æ•°ä¸­ä½¿ç”¨`super`ï¼Œå¯ä»¥è°ƒç”¨ç»§æ‰¿ç±»çš„é™æ€æ–¹æ³•ã€‚
  - ä¼šè¿”å›çˆ¶ç±»çš„`this`ï¼Œæ‰€ä»¥ã€! superå¿…é¡»åœ¨å­ç±»thisä¹‹å‰ã€‘ 
- callæ–¹æ³•ï¼š åœ¨å­æ„é€ å‡½æ•°ä¸­ï¼Œä½¿ç”¨`Father.call(this)`



â€‹	æ´¾ç”Ÿç±»ä¸­æ˜¾ç¤ºå®šä¹‰äº†æ„é€ å‡½æ•°ï¼Œè¦ä¹ˆğŸ”–è¿”å›è°ƒç”¨`super`è¿”å›çˆ¶ç±» ï¼Œè¦ä¹ˆğŸ·ï¸è¿”å›ä¸€ä¸ªå¯¹è±¡

```javascript
class Son extends Father(){
    constructor(){
        super();
    }
}
class Son extends Father(){
    constructor(){
        return {};
    }
}
```

### æŠ½è±¡åŸºç±»

â€‹	å¯ä»¥ç»™å…¶ä»–ç±»ç»§æ‰¿ï¼Œä½†æœ¬èº«ä¸èƒ½å®ä¾‹åŒ–ï¼›ä½¿ç”¨`new.target`è¯†åˆ«å½“å‰å®ä¾‹åŒ–çš„ç±»å‹ï¼Œä»è€Œå†³å®šè¦ä¸è¦å¯¹å…¶è¿›è¡Œå®ä¾‹åŒ–

```javascript
class Vehicle{
    constructor() {
		console.log(new.target);
        // è¯†åˆ«å½“å‰å®ä¾‹åŒ–çš„ç±»å‹
        if(new.target === Vehicle) throw new Error("Vehicle can't be directly instantiated")
        // ..
        
        // å¿…é¡»å®ç°æŸä¸ªæ–¹æ³•
        if(!this.foo) throw new Error("Inheriting class must define foo{}");
    }
}

new class Bus extends Vehicle {
    foo() {}
}
new class Bus extends Vehicle {} // Errorï¼šInheriting class must define foo{}
new class Vehicle {} // Errorï¼šVehicle can't be directly instantiated
```

### `species`è®¿é—®å™¨

â€‹	è¿”å›å®ä¾‹ç±»å‹ï¼Œå…¶è¢«æ„é€ å‡½æ•°ç”¨ä»¥åˆ›å»ºæ´¾ç”Ÿå¯¹è±¡ã€‚`getter`é»˜è®¤è¿”å›`this`ï¼Œæœªéƒ¨ç½²`setter`å±æ€§ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿”å›åŸå§‹å®ä¾‹ç±»å‹ä¸€è‡´ã€‚

â€‹	å¦‚æœéœ€è¦è¦†ç›–è¿™ä¸ªè¡Œä¸ºï¼Œå¯ä»¥åœ¨å­ç±»çš„æ„é€ å‡½æ•°å†…å£°æ˜ä¸ºé™æ€æ–¹æ³•ï¼Œæˆ–è€…ç”¨ `Object.defineProperty` ç­‰æ–¹æ³•æ·»åŠ æˆ–ä¿®æ”¹æ­¤å±æ€§ã€‚

```javascript
class MyArray extends Array {
  // è¦†ç›– species åˆ°çˆ¶çº§çš„ Array æ„é€ å‡½æ•°ä¸Š
  static get [Symbol.species]() {
    return Array;
  }
}

const myArray = new MyArray();
myArray instanceof MyArray; // false
myArray instanceof Array;   // true
```



### ç±»æ··å…¥

â€‹	æŠŠä¸åŒç±»è¡Œä¸ºé›†ä¸­åˆ°ä¸€ä¸ªç±»ä¸­ã€‚

:one: `Object.assign()`ï¼šå°†å¤šä¸ªå¯¹è±¡å±æ€§æ··å…¥

:two: `extend`å…³é”®å­—åæ¥è¡¨è¾¾å¼

```javascript
class Vehice {}
function getParentClass () {
    console.log('get superClass1')
    return Vehice;
}
class Bus extends getParentClass(); // Bus extends Vehice

// å¤šé‡ç»§æ‰¿: æ¥å—ä¸€ä¸ªè¶…ç±»åšä¸ºå‚æ•°ï¼Œå°†æ··å…¥ç±»å®šä¹‰ä¸ºè¿™ä¸ªå‚æ•°çš„å­ç±»
let doorMixin = (SuperClass) => class extends SuperClass{
    door() { console.log("add car door") }
}
let glassMixin = (SuperClass) => class extends SuperClass{
    glass() { console.log("add car glass") }
}

// 
class Bus extends doorMixin(glassMixin(Vehice)){}
let bus = new Bus();

// å€ŸåŠ©è¾…åŠ©å‡½æ•°ï¼Œå±•å¼€åµŒå¥—è°ƒç”¨
function mixin(BaseClass, ...Mixins){ // Aarry.reduce ç´¯åŠ éå†ï¼›accumulator ç´¯åŠ å™¨
	return Mixins.reduce((accumulator,current) => {
        return current(accumulator)
    }, BaseClass) // BaseClass åˆå§‹å€¼
}
class Bus extends mixin(Vehice,doorMixin,glassMixin){}
let bus = new Bus();
```

### ä¸‰ä¸ªæ³¨æ„ç‚¹

1. thisçš„æŒ‡å‘é—®é¢˜ï¼š
   1. constructor é‡Œçš„`this`æŒ‡å‘`åˆ›å»ºçš„å®ä¾‹å¯¹è±¡`
   2. ç±»ä¸­æ–¹æ³•çš„`this`æŒ‡å‘`è°ƒç”¨çš„å®ä¾‹å¯¹è±¡`
2. ç±»æ²¡æœ‰å˜é‡æç¤ºï¼šå¿…é¡»å…ˆå£°æ˜ã€åä½¿ç”¨
3. ä½¿ç”¨ç±»ä¸­å…±åŒå±æ€§ã€æ–¹æ³•ï¼Œä¸€å®šè¦åŠ this